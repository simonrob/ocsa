function showTaskPaneMessage(e,t){window.jQuery?$("#messageBox").text(e).show().delay(2500).queue(function(e){t&&$(this).hide(),e()}):console.log(e)}function resizeEditor(){const e=$("#signatureText"),t=e.closest(".trumbowyg-box").position().top,o=$("#saveSignature").position().top;let a=o-t-12;e.closest(".trumbowyg-box").css({height:a}),e.prev(".trumbowyg-editor").css({height:a}),e.css({height:a})}function cleanIDAndClassValues(e){return e.replaceAll(/(id|class)="x_(.*?)"/gi,'$1="$2"')}function saveSignature(e){var t;t=window.jQuery?cleanIDAndClassValues($("#signatureText").trumbowyg("html")):cleanIDAndClassValues(document.getElementById("signatureText").value),showTaskPaneMessage("✎    Saving…",!1),Office.context.roamingSettings.set(signatureSetting,Base64.encode(t)),Office.context.roamingSettings.saveAsync(function(e){e.status===Office.AsyncResultStatus.Succeeded?showTaskPaneMessage("✓    Saved",!0):(showTaskPaneMessage("✗    Save failed",!1),console.error("saveSignature",e.status,":",e.error.message))})}function addSignature(e){if("object"==typeof e){try{"function"==typeof e.completed&&(requestHeader=e)}catch(e){}e=!0}Office.context.roamingSettings.get(signatureSetting)||(console.log("saveSignature: no signature saved"),Office.context.ui.displayDialogAsync("https://www.robinson.ac/r/outlook-calendar-signature/taskpane.html"),requestHeader.completed(),requestHeader=void 0),Office.context.mailbox.item.body.getAsync(Office.CoercionType.Html,function(t){t.status===Office.AsyncResultStatus.Succeeded?e?(existingBody=t.value,appendSignature(!0,Base64.decode(Office.context.roamingSettings.get(signatureSetting)))):appendSignature(!1,t.value):console.log("addSignature",t.status,":",t.error.message)})}function appendSignature(e,t){e||(t=cleanIDAndClassValues(existingBody.replace(t,""))+t),Office.context.mailbox.item.body.setAsync(t,{coercionType:Office.CoercionType.Html},function(t){t.status===Office.AsyncResultStatus.Succeeded?e?addSignature(!1):"object"==typeof requestHeader&&(requestHeader.completed(),requestHeader=void 0):console.log("appendSignature",t.status,":",t.error.message)})}const signatureSetting="calendarSignature";let existingBody="",requestHeader=void 0;Office.onReady(e=>{if(e.host===Office.HostType.Outlook){const e=document.getElementById("saveSignature");if(e&&(e.onclick=saveSignature),window.jQuery)$(document).ready(function(){const e=["000000","262626","595959","8c8c8c","bfbfbf","d9d9d9","e9e9e9","f5f5f5","fafafa","ffffff","fbe9e6","fcede1","fcefd4","fcfbcf","e7f6d5","daf4f0","d9edfa","e0e8fa","ede1f8","f6e2ea","ffa39e","ffbb96","ffd591","fffb8f","b7eb8f","87e8de","91d5ff","adc6ff","d3adf7","ffadd2","ff4d4f","ff7a45","ffa940","ffec3d","73d13d","36cfc9","40a9ff","597ef7","9254de","f759ab","e13c39","e75f33","eb903a","f5db4d","72c040","59bfc0","4290f7","3658e2","6a39c9","d84493","cf1322","d4380d","d46b08","d4b106","389e0d","08979c","096dd9","1d39c4","531dab","c41d7f","820014","871400","873800","614700","135200","00474f","003a8c","061178","22075e","780650"],t=$("#signatureText");t.trumbowyg({btns:[["fontfamily","fontsize"],["bold","italic","underline"],["foreColor","backColor"],["link"],["viewHTML"]],semantic:!1,plugins:{colors:{foreColorList:e,allowCustomForeColor:!0,backColorList:e,allowCustomBackColor:!0}}}),Office.context.roamingSettings.get(signatureSetting)&&t.trumbowyg("html",Base64.decode(Office.context.roamingSettings.get(signatureSetting)));const o=100;t.closest(".trumbowyg-box").css({minHeight:o}),t.prev(".trumbowyg-editor").css({minHeight:o}),t.css({minHeight:o}),t.css({display:"block"}),$("#saveSignature").css({display:"block"}),$(window).on("resize",resizeEditor),resizeEditor()});else{const t=document.getElementById("signatureText");t&&(t.style.display="block"),e&&(e.style.display="block")}}});var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,o,a,n,r,s,i,c="",f=0;for(e=Base64._utf8_encode(e);f<e.length;)t=e.charCodeAt(f++),o=e.charCodeAt(f++),a=e.charCodeAt(f++),n=t>>2,r=(3&t)<<4|o>>4,s=(15&o)<<2|a>>6,i=63&a,isNaN(o)?s=i=64:isNaN(a)&&(i=64),c=c+this._keyStr.charAt(n)+this._keyStr.charAt(r)+this._keyStr.charAt(s)+this._keyStr.charAt(i);return c},decode:function(e){var t,o,a,n,r,s,i,c="",f=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");f<e.length;)n=this._keyStr.indexOf(e.charAt(f++)),r=this._keyStr.indexOf(e.charAt(f++)),s=this._keyStr.indexOf(e.charAt(f++)),i=this._keyStr.indexOf(e.charAt(f++)),t=n<<2|r>>4,o=(15&r)<<4|s>>2,a=(3&s)<<6|i,c+=String.fromCharCode(t),64!=s&&(c+=String.fromCharCode(o)),64!=i&&(c+=String.fromCharCode(a));return c=Base64._utf8_decode(c),c},_utf8_encode:function(e){var t="";e=e.replace(/\r\n/g,"\n");for(var o=0;o<e.length;o++){var a=e.charCodeAt(o);a<128?t+=String.fromCharCode(a):a>127&&a<2048?(t+=String.fromCharCode(a>>6|192),t+=String.fromCharCode(63&a|128)):(t+=String.fromCharCode(a>>12|224),t+=String.fromCharCode(a>>6&63|128),t+=String.fromCharCode(63&a|128))}return t},_utf8_decode:function(e){var t,o,a,n="",r=0;for(t=o=0;r<e.length;)t=e.charCodeAt(r),t<128?(n+=String.fromCharCode(t),r++):t>191&&t<224?(o=e.charCodeAt(r+1),n+=String.fromCharCode((31&t)<<6|63&o),r+=2):(o=e.charCodeAt(r+1),a=e.charCodeAt(r+2),n+=String.fromCharCode((15&t)<<12|(63&o)<<6|63&a),r+=3);return n}};